<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Control energètic eXIT</title>
    <link rel="stylesheet" href="resources/mainStyle.css">
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">
<!--    <link rel="stylesheet" href="../resources/mainStyle.css">-->

        <!-- llibreria d'icontes per al navbar-->
    <script src="https://kit.fontawesome.com/d259d5cefc.js" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>

    <style>
    .info-cards{
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        gap:20px;
        margin-top: 20px;
    }
    .info-card{
        display: block;
        text-decoration: none;
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 10px;
        width: 250px;
        text-align: center;
        color: #0f2418;
        transition: transform 0.2s ease, box-shadow 0.2s ease;

        i{
            font-size: 20px;
            color: #04AA6D;
            margin-bottom: 5px;
        }
        h3{
            margin-bottom: 5px;
            font-size:1.2rem;
        }
    }
    .info-card:hover{
        transform: scale(1.03);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
        color: #04D984;
    }


</style>
</head>
<body>
    <main>
        <header>
            <nav class="nav">
                <div class="navbar-container">
                    <a href="https://exit.udg.edu/ca/" class="nav-image-link" target="_blank">
                        <img src="./static/exitlogo.png" alt="Exit research group logo">
                    </a>
                    <div class="nav-items">
                        <a href="./" class="nav-link"> <i class="fa-solid fa-house"></i>  Inici</a>
                        <a href="./sensors" class="nav-link"> <i class="fa-solid fa-square-check"></i> Sensors</a>
                        <a href="./databaseView" class="nav-link"> <i class="fa-solid fa-database"></i> Base de Dades</a>
                        <a href="./model" class="nav-link"> <i class="fa-solid fa-brain"></i> Crear Model</a>
                        <a href="./config_page" class="nav-link"> <i class="fa-solid fa-user-gear"></i> Configuració</a>
                    </div>
                </div>
            </nav>
        </header>

        <section class="hero-section">
            <div class="hero-content">
                <h1>Benvindut/da a eXiT Control Energètic</h1>
                <p>Gestiona, visualitza i optimitza la teva energia</p>
            </div>
        </section>

        <div class="container">
            <br>
            <h2>Què pots fer?</h2>
            <br>

            <div class="info-cards">
                <a href="./sensors" class="info-card">
                    <i class="fa-solid fa-square-check"></i>
                    <h3>Sensors</h3>
                    <p>Selecciona els sensors dels quals vols monitoritzar i recollir dades.</p>
                </a>

                <a href="./databaseView" class="info-card">
                    <i class="fa-solid fa-database"></i>
                    <h3>Base de Dades</h3>
                    <p>Visualitza les dades en un rang de temps personalitzat.</p>
                </a>

                <a href="./model" class="info-card">
                    <i class="fa-solid fa-brain"></i>
                    <h3>Crear Model</h3>
                    <p>Entrena models predictius d'ús energètic per sensors específics i realitza les prediccions amb aquests.</p>
                </a>

                <a href="./config_page" class="info-card">
                    <i class="fa-solid fa-user-gear"></i>
                    <h3>Configuració</h3>
                    <p>Ajusta paràmetres d'usuari. Uneix-te o abandona una comunitat.</p>
                </a>

            </div>

            <div class="info-cards">
                <button id="test-optimization" onclick="TestOptimization()" ><i style="font-size: medium" class="fa-solid fa-ghost"></i> Test Optimitzar</button>

            </div>
            <div class="info-cards"><h1>Sensors Actius:</h1></div>
            <div class="info-cards" id="info-sensors-actius">

                <div class="info-card">
                    <h3 id="forecast-title" style="display:none;"></h3>
                    <div id="forecast-chart"></div>
                </div>
            </div>


        </div>
        
        <footer class="footer">
            <p>Created by: Grup Exit | Copyright &copy; 2024</p>
            <p><a href="mailto:comunitatenergeticaexit@gmail.com" class="mail-text">comunitatenergeticaexit@gmail.com</a></p>
        </footer>
    </main>
</body>

<script>
    function TestOptimization(){
        fetch('optimize')
            .then(response => response.text())
            .then(data => console.log("Optimization pressed"))
    }

    function onLoadPage(){
        console.log("onLoadPage");
        sensors_list = {{!active_sensors_list}};
        parent_div = document.getElementById("info-sensors-actius");
        sensors_list.forEach((sensor_id) =>{
            const sensor_name = document.createElement("h3");
            const sensor_info = document.createElement("div")

            sensor_name.innerHTML = sensor_id;
            sensor_info.innerHTML = "Encara no s'ha realitzat cap Forecast per aquest sensor";
            sensor_info.id = "forecast_cart_"+ sensor_id;

            parent_div.appendChild(sensor_name);
            parent_div.appendChild(sensor_info);

            fetch('get_forecast_data/' + sensor_id+'.pkl')
                .then(response => response.json())
                .then(data =>{
                    if(data.status ==="ok"){
                        console.log("this is the data :", data);

                        const realTimestamps = data.timestamps_overlap;
                        const realPredictions = data.predictions_overlap;
                        const realValues = data.real_values;
                        const futureTimestamps = data.timestamps_future;
                        const futurePredictions = data.predictions_future;

                        const traceReal = {
                        x: realTimestamps,
                        y: realValues,
                        mode: "lines",
                        name: "Dades Reals",
                        line: {color: 'red', dash: 'dot'}
                        };
                        const tracePredReal = {
                        x: realTimestamps,
                        y: realPredictions,
                        mode: 'lines',
                        name: 'Predicció (part real)',
                        line: { color: 'green' }
                        };
                        const tracePredFuture = {
                        x: futureTimestamps,
                        y: futurePredictions,
                        mode: 'lines',
                        name: 'Predicció (futur)',
                        line: {color: 'orange', dash: 'dot'}
                        }
                        const layout = {
                        title: 'Predicció vs Dades Reals',
                        xaxis: {title: 'Temps'},
                        yaxis: {title: 'Consum (Kw)'},
                        width: 800,
                        height: 500
                        };

                        Plotly.newPlot('forecast-chart_'+sensor_id, [traceReal, tracePredReal, tracePredFuture], layout);



                    }
                    else{
                        console.log("no data for ", sensor_id);
                    }
                });


        });
    }


    onLoadPage();

</script>

</html>