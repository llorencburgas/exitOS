<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Control energètic eXIT</title>
    <link rel="stylesheet" href="static/main.css">
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">

    <!-- llibreria d'icones per al navbar-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--  PLOTLY: gràfiques  -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!--  jQuery, Moments.js, Date Range Picker Files  -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />


    <style>
        h1{
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <main>
        <header>
            <nav class="nav">
                <div class="navbar-container">
                    <a href="https://exit.udg.edu/ca/" class="nav-image-link" target="_blank">
                        <img src="./static/exitlogo.png" alt="Exit research group logo">
                    </a>
                    <a href="./" class="nav-link"> <i class="fa fa-fw fa-home"></i> Inici</a>
                    <a href="./sensors" class="nav-link"> <i class="fa fa-fw fa-search"></i> Sensors</a>
                    <a href="./databaseView" class="nav-link"> <i class="fa fa-fw fa-envelope"></i> Base de Dades</a>
                    <a href="./" class="nav-link"> <i class="fa fa-fw fa-user"></i> Pàgina 4</a>
                </div>
            </nav>
        </header>


        <div class="container">
            <div class="content-section">
                <h1>Data</h1>

                <label> Tria un rang de dates:
                    <input type="text" name="datetimes" />

                 </label>

                <div id="sensor-data" data-sensors="{{sensors_id}}"></div>

                <div class="sensor-container">
                    <h2>Sensors a Mostrar:</h2>
                    <div class="tag-container" id="selected-sensors"></div>

                    <div class="dropdown">
                        <input type="text" class="search-box" id="sensor-search" placeholder="Cerca i seleccioni sensors...">
                        <ul class="sensor-list" id="sensor-list"></ul>
                    </div>
                </div>




                % for sensor_id, graph_html in graphs.items():
                    <h2>Sensor {{ sensor_id }}</h2>
                    <div>{{!graph_html}}</div>
                % end
            </div>
        </div>

        <footer class="footer">
            <p>Created by: Grup Exit | Copyright &copy; 2024</p>
            <p><a href="mailto:comunitatenergeticaexit@gmail.com" class="mail-text">comunitatenergeticaexit@gmail.com</a></p>
        </footer>
    </main>
</body>

<script>

    let sensors = document.getElementById("sensor-data").getAttribute("data-sensors").split(",");

    console.log(sensors);

    const selectedSensors = new Set();
    const sensorSearch = document.getElementById("sensor-search");
    const sensorList = document.getElementById("sensor-list");
    const selectedSensorsContainer = document.getElementById("selected-sensors");

    //Funció per actualitzar els sensors del Dropdown
    function updateSensorList(filteredSensors){
      sensorList.innerHTML = "";
      if(filteredSensors.length > 0) {
          sensorList.style.display = "block";
          filteredSensors.forEach(sensor => {
              const li = document.createElement("li");
              li.textContent = sensor;
              li.onclick = () => selectSensor(sensor);
              sensorList.appendChild(li);
          });
      }else{
          sensorList.style.display = "none";
      }
    }

    //Mostra la llista completa de sensors
    sensorSearch.addEventListener("focus", () => {
    updateSensorList(sensors);
    });

    //Filtra dinamicament mentre s'escriu
    // sensorSearch.addEcentListener("input", () => {
    //   const query = sensorSearch.value.toLowerCase();
    //   const filteredSensors = sensors.filter(sensor => sensor.toLowerCase().includes(query));
    //   updateSensorList(filteredSensors);
    // }




    $(function() {
      $('input[name="datetimes"]').daterangepicker({
        timePicker: true,
        timePicker24Hour: true,
        timePickerIncrement: 1,
        autoUpdateInput: false,
        startDate: moment().startOf('hour'),
        endDate: moment().startOf('hour').add(24, 'hour'),
        showDropdowns: true,
        locale: {
          format: 'M/DD hh:mm A',
          separator: " - ",
          applyLabel: 'Aplicar',
          cancelLabel: "Cancel·lar",
          daysOfWeek: ["Di", "Dl", "Dt", "Dc", "Dj", "Dv", "Ds"],
          monthNames: ["Gen", "Feb", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Oct", "Nov", "Des"],
          firstDay: 1
        },
          ranges: {
            'Últims 7 Dies': [moment().subtract(6, 'days'), moment()],
            'Últims 30 dies': [moment().subtract(29, 'days'), moment()],
            'Aquest Mes': [moment().startOf('month'), moment().endOf('month')],
            'Mes Passat': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          },
          alwaysShowCalendars: true,
      },function(start, end, label){
            console.log("A new date selection was made: " + start.format('YYYY-MM-DD hh:mm:ss') + ' to ' + end.format('YYYY-MM-DD hh:mm:ss'))
      });
    });
    </script>
</html>